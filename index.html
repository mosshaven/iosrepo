<!DOCTYPE html>
<html lang="ru">
<head>
    <title>slutvibe Repo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --main-yellow: #f1c40f; --dark-bg: #0d0d0d; --card-bg: #1c1c1e; }
        body { background: var(--dark-bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 20px; line-height: 1.4; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: var(--main-yellow); font-size: 2.8em; margin-bottom: 5px; letter-spacing: -1px; }
        .btn { background: var(--main-yellow); color: #000; padding: 14px 25px; border-radius: 12px; text-decoration: none; font-weight: 700; display: inline-block; transition: 0.2s; border:none; }
        .btn:hover { opacity: 0.8; transform: scale(0.98); }
        h4 { text-align: left; margin: 30px 0 15px; color: var(--main-yellow); border-bottom: 1px solid #333; padding-bottom: 5px; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; }
        .package-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .tweak-item { background: var(--card-bg); padding: 15px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid #2c2c2e; transition: 0.2s; }
        .tweak-item:hover { background: #262629; border-color: var(--main-yellow); }
        .tweak-icon { width: 64px; height: 64px; border-radius: 15px; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .tweak-name { font-weight: 600; font-size: 0.9em; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); z-index: 100; }
        .modal-content { background: var(--card-bg); width: 90%; max-width: 400px; border-radius: 30px; padding: 30px; border: 1px solid #333; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        .modal-header img { width: 80px; height: 80px; border-radius: 20px; }
        .close-btn { position: absolute; top: 20px; right: 25px; font-size: 30px; cursor: pointer; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>slutvibe</h1>
        <p style="opacity:0.5; margin-bottom: 30px;">iOS 12 & Below Legacy Repository</p>
        <a class="btn" href="sileo://source/https://fragmentmusic.xyz/">ДОБАВИТЬ В SILEO</a>
        <div id="repo-content"></div>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="document.getElementById('modalOverlay').style.display='none'">&times;</span>
            <div id="modalData"></div>
        </div>
    </div>

    <script>
        fetch('Packages')
            .then(res => res.text())
            .then(data => {
                const content = document.getElementById('repo-content');
                const packages = data.split('\n\n');
                const categories = {};

                packages.forEach(block => {
                    const get = (f) => {
                        const m = block.match(new RegExp(`^${f}: (.*)$`, 'm'));
                        return m ? m[1] : null;
                    };
                    const name = get('Name');
                    if (!name) return;

                    const pkg = { 
                        name, 
                        id: get('Package'), 
                        version: get('Version'), 
                        desc: get('Description') || 'Без описания', 
                        section: get('Section') || 'Applications', 
                        icon: get('Icon') || 'CydiaIcon.png' 
                    };
                    if (!categories[pkg.section]) categories[pkg.section] = [];
                    categories[pkg.section].push(pkg);
                });

                for (const [cat, pkgs] of Object.entries(categories)) {
                    const h4 = document.createElement('h4'); h4.innerText = cat;
                    const grid = document.createElement('div'); grid.className = 'package-grid';
                    pkgs.forEach(pkg => {
                        const div = document.createElement('div');
                        div.className = 'tweak-item';
                        div.innerHTML = `<img class="tweak-icon" src="${pkg.icon}" onerror="this.src='CydiaIcon.png'"><span class="tweak-name">${pkg.name}</span>`;
                        div.onclick = () => {
                            document.getElementById('modalData').innerHTML = `
                                <div class="modal-header">
                                    <img src="${pkg.icon}" onerror="this.src='CydiaIcon.png'">
                                    <div><h3 style="margin:0">${pkg.name}</h3><p style="opacity:0.4;font-size:0.8em;margin:0">${pkg.id}</p></div>
                                </div>
                                <div style="background:#2c2c2e; padding:15px; border-radius:15px; font-size:0.9em; margin-bottom:20px;">${pkg.desc}</div>
                                <div style="display:flex; justify-content:space-between; font-size:0.8em; opacity:0.5; margin-bottom:20px;">
                                    <span>Версия: ${pkg.version}</span>
                                    <span>Секция: ${pkg.section}</span>
                                </div>
                                <a href="sileo://package/${pkg.id}" class="btn" style="width:100%;text-align:center;box-sizing:border-box">ОТКРЫТЬ В SILEO</a>
                            `;
                            document.getElementById('modalOverlay').style.display = 'flex';
                        };
                        grid.appendChild(div);
                    });
                    content.appendChild(h4); content.appendChild(grid);
                }
            });
    </script>
</body>
</html>